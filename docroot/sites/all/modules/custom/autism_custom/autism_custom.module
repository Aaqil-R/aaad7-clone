<?php
function autism_custom_views_post_execute(&$view) { 	 
 if($view->name == "stream" && $view->current_display == 'stream_topic_page' && $view->query->pager->current_page === 0) {
	 $nidarg = arg(1);  
	 if ($nidarg > 0) {
    	 $node = node_load($nidarg);
         $data = new stdclass(); 
         $items = $view->result[0];
         foreach($items as $key => $item) {
			 if ($key == 'nid') {
                $data->nid = $node->nid;
	         } elseif ($key == 'node_created') {
                $data->node_created = $node->created;
             } else {
			   $data->{$key} = is_array($item) ? array() : '';	 
			 }
	     }
         array_unshift($view->result, $data);
    } 
 }  
    
}

function getcommentcount_past2week($nid) {
  if (!is_numeric($nid)){
    return false;
  }
  $time = time();
  $from = time() - 1209600;
  
  // Create an object of type SelectQuery
  $query = db_select('comment', 'c');
   
  // Add extra detail to this query object: a condition, fields and a range
  $query->condition('c.created', array($from, $time), 'between');
  $query->condition('c.nid', $nid);
  $query->fields('c');
  return $query->countQuery()->execute()->fetchField();
}
